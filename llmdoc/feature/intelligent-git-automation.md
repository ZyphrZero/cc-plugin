# 智能Git自动化

## 1. Purpose

智能Git自动化功能通过commit命令提供基于Git变化的高质量提交信息生成服务。该功能分析当前仓库状态、历史提交格式和代码变更性质，自动生成符合项目风格的提交信息，简化开发团队的Git工作流程。

## 2. How it Works / Step-by-Step Guide

### 核心工作流程

1. **并行信息收集**: 使用worker agent同时执行多个Git命令获取仓库状态
2. **变化分析**: 分析分支名称、文件类型、变更范围和历史提交风格
3. **智能生成**: 基于分析结果生成符合项目规范的提交信息
4. **用户确认**: 通过AskUserQuestion提供用户确认或修改机制

### 并行Git信息获取

commit命令使用worker agent并行执行以下命令：
- `git diff` - 查看未暂存的变更
- `git diff --staged` - 查看已暂存的变更
- `git status` - 查看当前分支和文件状态
- `git log --oneline -10` - 查看最近10次提交了解格式风格

### 智能分析机制

- **分支分析**: 从分支名称推断功能类型(feat/fix/hotfix等)
- **文件类型**: 识别代码、文档、配置等不同类型的文件变更
- **变更性质**: 区分新功能、bug修复、重构、文档更新等变更类型
- **格式学习**: 从历史提交中学习项目的提交信息格式规范

### 输出质量保证

- **长度控制**: 英文提交信息第一行保持在50-72字符内
- **类型规范**: 支持约定式提交格式(feat/fix/docs/refactor/test/chore)
- **风格一致**: 严格遵循项目的历史提交信息风格
- **描述准确**: 清晰说明变更的目的而非仅仅是变更内容

## 3. Relevant Code Modules

- `commands/commit.md` - commit命令定义，包含完整的工作流程和步骤说明
- `agents/worker.md` - worker agent定义，负责执行Git信息收集和分析任务
- `README.md` / `README.zh-CN.md` - 项目主文档，包含commit命令的使用说明

## 4. Attention

- **Git状态检查**: 命令执行前必须检查Git仓库状态，处理无变更或未暂存的情况
- **权限依赖**: 需要Git仓库的读取权限和状态查询权限
- **格式学习**: 依赖历史提交记录，新项目可能需要手动建立格式规范
- **用户交互**: 通过AskUserQuestion机制需要用户确认，确保提交信息质量
- **并行执行**: worker agent的并行Git命令执行需要合理的超时设置
- **多语言支持**: 支持中英文提交信息，需要根据项目历史确定语言偏好
- **分支约定**: 分支命名规范影响提交信息类型的自动判断准确性