# 深度代码库调研

## 1. Purpose

深度代码库调研功能通过scout agent提供结构化的代码分析和基于证据的调查报告生成服务。该功能专为理解复杂系统架构、API端点设计、功能实现细节等场景设计，采用严格的客观分析方法，避免主观判断，提供可信赖的代码库理解结果。

## 2. How it Works / Step-by-Step Guide

### 核心工作流程

1. **文档索引读取**: 始终从读取`<ProjectRootPath>/llmdoc/index.md`开始
2. **创建调查文档**: 基于任务数量创建一个或多个markdown文档
3. **深度代码分析**: 使用Read、Grep、Glob等工具广泛检查代码文件
4. **生成客观报告**: 基于收集的证据完成报告部分
5. **结构化输出**: 按照标准化格式输出调查结果

### 调查文档结构

每个调查文档都遵循严格的两段式结构：
- **第一部分 - 证据**: 支持结论的文件和代码段
- **第二部分 - 事实发现**: 基于证据的客观结论

### 严格工作要求

#### 客观性原则
- 禁止价值判断词汇(如"高效"、"清晰"、"现代化"等)
- 只陈述客观事实(使用X模式、实现Y功能、包含Z组件等)
- 基于实际代码内容而非假设或文件名推测

#### 文档规范
- **文件命名**: 必须使用多个单词连字符分隔，完全描述文档内容
- **长度限制**: 硬性限制200行，超过时需优先保留关键信息
- **单一主题**: 每个文档只解决一个问题，禁止混合无关主题
- **无重复内容**: 确保不同文档间零重叠

### 信息收集策略

- **广泛读取**: 深入阅读实际代码文件，不依赖文件名推测
- **并行分析**: 可部署2-3个scout agent同时处理不同领域
- **精确引用**: 引用确切的代码、文件路径和行号
- **证据导向**: 所有结论都必须有明确的代码证据支持

## 3. Relevant Code Modules

- `agents/scout.md` - scout agent完整定义，包含工作流程和强制要求
- `commands/withScout.md` - withScout命令，提供scout agent的调用框架
- `llmdoc/agent/` 目录 - scout agent生成的调查文档存储位置
- `<ProjectRootPath>/llmdoc/index.md` - 文档索引入口，scout工作的起点

## 4. Attention

- **入口依赖**: scout agent严格依赖`<ProjectRootPath>/llmdoc/index.md`存在性
- **文档长度**: 200行硬性限制，超长文档会被视为失败
- **证据要求**: 所有结论必须有具体的代码段或文件内容支持
- **文件命名**: 必须使用描述性文件名，避免简短或模糊的命名
- **并发控制**: 同时启动的scout agent数量建议控制在2-3个以内
- **输出格式**: 必须按照指定的Code Sections和Report格式输出
- **内容纯粹性**: 禁止任何主观判断、价值评估或推测性内容
- **重复检查**: 多个scout agent并行工作时需要确保信息不重叠