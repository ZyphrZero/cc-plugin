# 命令开发规范

## 1. Purpose

规范新命令的创建流程、参数定义、执行逻辑设计和输出格式标准化，确保新命令能够有效集成到现有的命令系统中，提供一致的用户体验和可预测的执行行为。

## 2. How it Works / Step-by-Step Guide

### Step 1: 需求分析和场景定义
1. 明确命令要解决的具体问题和使用场景
2. 分析命令的输入参数和执行环境要求
3. 设计命令的核心工作流程和执行步骤
4. 确定命令调用的agent类型和协作模式

### Step 2: 命令文件创建
1. 在`commands/`目录下创建新的markdown文件
2. 文件命名使用kebab-case格式，清晰描述命令功能
3. 采用YAML前置元数据格式定义命令属性

### Step 3: 基本结构定义
命令文件必须包含以下标准结构：

#### YAML前置元数据
```yaml
---
description: [命令功能的简要描述]
---
```

#### 核心定义
- 命令的完整描述和用途说明
- 详细的执行步骤和工作流程
- 与agent的交互模式和调用方式
- 输入参数的格式和验证规则
- 输出结果的格式和内容要求

### Step 4: Agent集成设计
根据命令特点选择合适的agent：
- **scout agent**: 用于深度代码分析和调研任务
- **worker agent**: 用于具体的执行任务和操作
- **recorder agent**: 用于文档生成和知识管理

### Step 5: 执行流程设计
1. **输入处理**: 定义参数解析和验证逻辑
2. **任务分解**: 将复杂任务分解为可执行的步骤
3. **Agent调用**: 明确定义agent的调用时机和参数
4. **结果整合**: 设计agent输出的整合和处理方式
5. **用户交互**: 确定需要用户确认或选择的交互点

### Step 6: 错误处理和边界条件
1. 设计异常情况的处理流程
2. 定义用户输入错误的反馈机制
3. 制定agent执行失败的恢复策略
4. 确保命令在各种环境下的稳定性

### Step 7: 集成测试
1. 创建不同场景的测试用例
2. 验证命令与agent的交互正确性
3. 测试错误处理和边界条件
4. 验证输出格式的规范性

### Step 8: 文档更新
1. 更新Commands命令系统文档
2. 在index.md中添加新命令条目
3. 创建使用示例和最佳实践
4. 更新相关的技术架构文档

## 3. Relevant Code Modules

- `commands/commit.md` - 命令定义的标准模板和示例
- `commands/withScout.md` - 复杂命令的工作流程设计参考
- `commands/withDoc.md` - 命令与agent协作的示例
- `llmdoc/feature/command-system.md` - Commands系统架构文档
- `agents/` 目录下的agent定义文件 - 命令调用的目标agent

## 4. Attention

- **功能唯一**: 确保新命令不与现有命令功能重叠
- **命名清晰**: 命令名称应该直观反映其功能用途
- **流程标准**: 遵循现有命令的执行流程和设计模式
- **Agent匹配**: 选择最合适的agent类型处理命令任务
- **参数规范**: 明确定义输入参数的格式和验证规则
- **输出一致**: 遵循标准化的输出格式和结果结构
- **错误处理**: 设计完善的错误处理和用户反馈机制
- **用户友好**: 提供清晰的错误信息和使用指导
- **测试完整**: 覆盖正常流程、异常情况和边界条件的测试
- **文档同步**: 创建完成后必须立即更新所有相关文档
- **向后兼容**: 考虑命令升级时的向后兼容性问题