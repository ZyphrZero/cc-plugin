# 代理开发规范

## 1. Purpose

规范新代理的创建流程、命名约定、功能定义和工作流程设计，确保新代理能够无缝集成到现有的协作系统中，保持与其他代理的一致性和互操作性。

## 2. How it Works / Step-by-Step Guide

### Step 1: 需求分析和设计
1. 明确定义代理的核心职责和使用场景
2. 分析与现有代理的功能边界，避免职责重叠
3. 设计代理的工作流程和输入输出格式
4. 确定所需的工具权限和模型配置

### Step 2: 代理文件创建
1. 在`agents/`目录下创建新的markdown文件
2. 文件命名使用kebab-case格式，清晰描述代理功能
3. 采用YAML前置元数据格式定义代理属性

### Step 3: 基本结构定义
代理文件必须包含以下标准结构：

#### YAML前置元数据
```yaml
---
name: [agent-name]
description: [代理功能的简要描述]
tools: [工具列表，用逗号分隔]
model: [模型类型，通常为haiku]
color: [颜色标识，便于区分]
---
```

#### 模型配置
添加CCR子代理模型配置：
```yaml
<CCR-SUBAGENT-MODEL>glm,glm-4.6</CCR-SUBAGENT-MODEL>
```

#### 核心定义
- 代理身份和职责的明确描述
- 工作流程的详细说明
- 输入输出格式规范
- 与其他代理的协作模式

### Step 4: 工作权限配置
根据代理职责配置适当的工具权限：
- **基础权限**: Read, Write, Edit, Glob, Grep, Bash
- **扩展权限**: WebSearch, WebFetch(如需外部信息)
- **交互权限**: AskUserQuestion(如需用户交互)

### Step 5: 集成测试
1. 创建测试用例验证代理功能
2. 测试与其他代理的协作流程
3. 验证输入输出格式的正确性
4. 检查错误处理和边界条件

### Step 6: 文档更新
1. 使用recorder agent更新相关文档
2. 在index.md中添加新代理的条目
3. 更新Agent系统架构文档
4. 添加使用示例和最佳实践

## 3. Relevant Code Modules

- `agents/scout.md` - 代理定义的标准模板和示例
- `agents/worker.md` - 代理工作流程设计参考
- `agents/recorder.md` - 代理输出格式规范参考
- `llmdoc/feature/agent-system.md` - Agent系统架构文档
- `llmdoc/feature/agent-collaboration.md` - 代理协作机制文档

## 4. Attention

- **职责边界**: 确保新代理不与现有代理功能重叠
- **命名规范**: 代理名称必须清晰描述其核心功能
- **工具权限**: 只配置必要的工具权限，遵循最小权限原则
- **格式一致**: 遵循现有代理的文件结构和格式规范
- **协作设计**: 明确定义与其他代理的协作方式和接口
- **模型配置**: 必须包含CCR子代理模型配置以获得最佳性能
- **错误处理**: 设计健壮的错误处理和恢复机制
- **文档同步**: 创建完成后必须立即更新相关文档
- **测试验证**: 充分测试代理功能，特别是与现有系统的集成
- **性能考虑**: 考虑代理的执行性能和资源使用效率